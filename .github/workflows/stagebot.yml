name: stagebot
on:
  issue_comment:
    types: [created]
jobs:
  stagebot:
    if: startsWith( ${{ github.event.comment.body }}), 'stagebot foo' )
    runs-on: ubuntu-latest
    steps:
      - run: |
          export ENV_COMMIT_TO_STAGE=$(echo "${{ github.event.comment.body }})" | sed -E 's/stagebot stage (e3320f).*/\1/g')
          echo "::set-env name=COMMIT_TO_STAGE::$ENV_COMMIT_TO_STAGE"
      - run: echo $COMMIT_TO_STAGE
      - run: echo ${{github.event.issue.head.repo.full_name}}
      - run: echo ${{github.event.issue.head.repo}}
      - run: |
          mkdir clones
          cd clones
          git clone https://github.com/${{ github.repository }} REPOSITORY
          cd REPOSITORY
          git remote add fork https://github.com/DilumAluthge/juliahealth.github.io
          git fetch --all --prune
          git branch --delete --force staging/pull_request/${{ github.event.issue.number }} || echo "branch does not exist"
          git checkout COMMITTHATDOESNOTEXIST -b staging/pull_request/${{ github.event.issue.number }}
          git push --force origin staging/pull_request/${{ github.event.issue.number }}
